        function updateChart(timeMap) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // 1. Sort by Key (YYYY-MM-DD... ensures chronological order)
            const sortedKeys = Object.keys(timeMap).sort();
            
            // 2. Map to Display Labels (DD/MM/YY)
            const labels = sortedKeys.map(key => {
                try {
                    const [datePart, timePart] = key.split(' ');
                    const [y, m, d] = datePart.split('-');
                    const displayDate = `${d}/${m}/${y.slice(-2)}`; // DD/MM/YY
                    return timePart ? `${displayDate} ${timePart}` : displayDate;
                } catch (e) {
                    return key;
                }
            });

            const data = sortedKeys.map(l => timeMap[l]);

            if(chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales Amount',
                        data: data,
                        backgroundColor: '#4f46e5',
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (ctx) => ctx[0].label, // Show formatted date in tooltip title
                                label: (ctx) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(ctx.raw)
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { borderDash: [2, 4], color: '#f1f5f9' },
                            ticks: { color: '#94a3b8', font: { size: 11 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8', font: { size: 11 }, maxTicksLimit: 10 }
                        }
                    }
                }
            });
        }
